{% extends "layout.html" %}

{% block body %}

<h2>{{ topic.title }}</h2>

<small>
  <i>
  Discussion started by {{ topic.creator }} on {{ topic.date_created.strftime('%d.%m.%Y')}}.</i>
</small>

<hr>

<div style="width:60%">
  {% if messages %}
    {% for message in messages.items %}
    <div>
      <div>
        <small>Written by {{ message.author }} @ {{ message.date_created.strftime('%d.%m.%Y %-H:%M')}} &nbsp;--&nbsp; message {{ loop.index }}/{{ loop.length }}</small>
      
        <p style="white-space: pre-line;">{{ message.content }}</p>

        <a href="/topics/{{ topic.id }}/messages/{{ message.id }}/" class="btn btn-outline-primary btn-sm" role="button">Reply</a>
        <small>
          <a href="/topics/{{ topic.id }}/messages/{{ message.id }}/">See replies.</a>
        </small>
        {% if message.account_id == current_user.id %}
        <a href="/messages/{{ message.id }}/edit" class="btn btn-outline-primary btn-sm" role="button">Edit reply</a>
        {% endif%}
        <hr>      

      </div>
    </div>
    {% endfor %}
  {% else %}
  <div>
    <p>No messages yet in this topic. Please feel free to start the discussion!</p>
  </div>
  {% endif %}
</div>

<div>
  {% for page in messages.iter_pages() %}
  {% if page != messages.page %}
  <a href="{{ url_for('topics_get_one_paginated', topic_id=topic.id, page=page) }}">
  {{ page }}</a>
  {% else %}
  {{ page }}
  {% endif %}
  {% endfor %}
</div>

<br />

<form method="POST" action="/topics/{{ topic.id }}/messages/new">
  Add a new message to the topic:<br />
  {{ form.name(cols="60", rows="6") }}<br />
  <ul>
    {% for error in form.name.errors %}
    <li>{{ error }}</li>
    {% endfor %}
  </ul>
  <input type="submit" value="Add message" />
</form>

{% endblock %}