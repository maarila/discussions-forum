{% extends "layout.html" %}

{% block body %}

<a href="/topics/{{ topic.id }}/">< Return to "{{ topic.title }}"</a>
<hr>
<small><a href="{{ url_for('users_get_one', user_id=message.account_id) }}"> {{ message.author }}</a> @ {{ message.date_created.strftime('%d.%m.%Y %-H:%M')}} </small>
      
<div style="white-space: pre-line;">{{ message.content }}</div>

{% if message.account_id == current_user.id %}
  <a href="/messages/{{ message.id }}/edit" class="btn btn-outline-primary btn-sm" role="button">Edit</a>
{% endif%}
<div>
  <small>Read by:
  {% for view in message.views %}
    {% if view.id != message.account_id %} 
      <a href="/users/{{ view.id }}/">{{ view.name }}&nbsp;&nbsp;</a>
    {% endif %}
  {% endfor %}
  </small>
</div>

<hr>

<div class="container">
{% for reply in replies %}
  <small>Reply by <a href="{{ url_for('users_get_one', user_id=reply.account_id) }}"> {{ reply.author }}</a> @ {{ reply.date_created.strftime('%d.%m.%Y %-H:%M')}}</small>
      
  <div style="white-space: pre-line;">{{ reply.content }}</div>

  <small>
    <a href="/topics/{{ topic.id }}/messages/{{ reply.id }}/">See replies or write a reply</a>
  </small>

  {% if reply.account_id == current_user.id %}
  <a href="/messages/{{ reply.id }}/edit" class="btn btn-outline-primary btn-sm" role="button">Edit your reply</a>
  {% endif%}
  <div>
    <small>Read by:
    {% for view in reply.views %}
      {% if view.id != reply.account_id %} 
        <a href="/users/{{ view.id }}/">{{ view.name }}&nbsp;&nbsp;</a>
      {% endif %}
    {% endfor %}
    </small>
  </div>
  <hr>
{% endfor %}
</div>

<ul>
  {% for error in form.name.errors %}
    <li style="color: red">{{ error }}</li>
  {% endfor %}
</ul>

<form method="POST" action="/topics/{{ topic.id }}/messages/{{ message.id }}/reply">
  Reply to message:<br />
  {{ form.name(cols="70", rows="9") }}<br />
  <input type="submit" class="btn btn-outline-primary" value="Reply" />
</form>
{% endblock %}
